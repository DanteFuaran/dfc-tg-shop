{% extends "base.html" %}
{% block title %}–ö–∞–±–∏–Ω–µ—Ç{% endblock %}

{% block content %}
<div class="bg-glow"></div>
<div class="app-wrapper">

<header class="app-header">
    <div class="brand">
        <span class="brand-logo" id="brand-logo">üîê</span>
        <div class="brand-info">
            <span class="brand-name" id="brand-name">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</span>
            <span class="brand-slogan" id="brand-slogan"></span>
        </div>
    </div>
    <button class="btn-icon" onclick="logout()" title="–í—ã–π—Ç–∏">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
        </svg>
    </button>
</header>

<main class="app-content">

<!-- ‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê -->
<section id="p-home" class="page active">
    <div class="card sub-card">
        <div class="sub-card-top">
            <span class="sub-badge sub-badge-none" id="sub-badge">‚Äî</span>
            <span class="sub-expire" id="sub-expire"></span>
        </div>
        <div class="sub-traffic" id="sub-traffic"></div>
    </div>
    <div class="action-pills">
        <button class="pill trial-pill" id="btn-trial" onclick="startTrial()" style="display:none">üéÅ&nbsp; –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
        <button class="pill pill-gold" onclick="go('plans')">üõí&nbsp; –ö—É–ø–∏—Ç—å</button>
        <button class="pill pill-cyan" onclick="go('connect')">‚äô&nbsp; –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å</button>
        <div class="pill-row">
            <button class="pill pill-outline" onclick="go('promo')">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥—ã</button>
            <button class="pill pill-outline" onclick="go('devices')">üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</button>
        </div>
    </div>
</section>

<!-- ‚ïê‚ïê‚ïê PLANS ‚ïê‚ïê‚ïê -->
<section id="p-plans" class="page">
    <div class="page-header">
        <button class="btn-back" onclick="go('home')">‚Äπ</button>
        <h2 class="page-title">–¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã</h2>
    </div>
    <div id="plans-list" class="plans-list"></div>
</section>

<!-- ‚ïê‚ïê‚ïê CONNECT ‚ïê‚ïê‚ïê -->
<section id="p-connect" class="page">
    <div class="page-header">
        <button class="btn-back" onclick="go('home')">‚Äπ</button>
        <h2 class="page-title">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h2>
    </div>
    <div class="card">
        <div class="card-title">–°—Å—ã–ª–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏</div>
        <div class="connect-box">
            <code id="con-url">‚Äî</code>
            <button onclick="copyUrl()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
    </div>
    <div class="card">
        <div class="card-title">–°–∫–∞—á–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
        <div class="apps-grid">
            <a class="app-link" href="https://apps.apple.com/app/happ-proxy-utility-plus/id6746188973" target="_blank"><span class="app-icon">üçè</span> iOS</a>
            <a class="app-link" href="https://play.google.com/store/apps/details?id=com.happproxy" target="_blank"><span class="app-icon">ü§ñ</span> Android</a>
            <a class="app-link" href="https://github.com/Happ-proxy/happ-desktop/releases/latest/download/setup-Happ.x64.exe" target="_blank"><span class="app-icon">ü™ü</span> Windows</a>
            <a class="app-link" href="https://github.com/Happ-proxy/happ-desktop/releases/" target="_blank"><span class="app-icon">üçé</span> macOS</a>
        </div>
    </div>
</section>

<!-- ‚ïê‚ïê‚ïê DEVICES ‚ïê‚ïê‚ïê -->
<section id="p-devices" class="page">
    <div class="page-header">
        <button class="btn-back" onclick="go('home')">‚Äπ</button>
        <h2 class="page-title">–ú–æ–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h2>
    </div>
    <div class="card">
        <div class="card-row"><span class="card-label">–õ–∏–º–∏—Ç</span><span class="card-value" id="dev-limit">‚Äî</span></div>
        <div class="card-row"><span class="card-label">–ó–∞–Ω—è—Ç–æ</span><span class="card-value" id="dev-used">‚Äî</span></div>
    </div>
    <div class="action-pills" style="margin-top:10px">
        <button class="pill pill-outline" id="btn-expand-devices" onclick="expandDevices()" style="display:none">‚ûï –†–∞—Å—à–∏—Ä–∏—Ç—å —Å–ª–æ—Ç—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤</button>
    </div>
</section>

<!-- ‚ïê‚ïê‚ïê PROMO ‚ïê‚ïê‚ïê -->
<section id="p-promo" class="page">
    <div class="page-header">
        <button class="btn-back" onclick="go('home')">‚Äπ</button>
        <h2 class="page-title">–ü—Ä–æ–º–æ–∫–æ–¥—ã</h2>
    </div>
    <div class="card">
        <div class="card-title">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</div>
        <div style="display:flex;gap:8px">
            <input class="form-input" id="promo-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥" style="flex:1">
            <button class="btn btn-primary btn-sm" onclick="activatePromo()">OK</button>
        </div>
        <p id="promo-result" style="font-size:.8rem;margin-top:8px;display:none"></p>
    </div>
</section>

<!-- ‚ïê‚ïê‚ïê SUPPORT ‚ïê‚ïê‚ïê -->
<section id="p-support" class="page">
    <div class="page-header">
        <button class="btn-back" onclick="go('home')">‚Äπ</button>
        <h2 class="page-title">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
    </div>
    <div class="card card-compact" style="cursor:pointer" onclick="go('tickets')">
        <div class="card-title">üé´ –¢–∏–∫–µ—Ç—ã <span id="ticket-badge" class="ticket-badge" style="display:none">0</span></div>
        <span class="pill pill-cyan pill-sm">–û—Ç–∫—Ä—ã—Ç—å</span>
    </div>
    <div class="card card-compact" id="support-community" style="display:none">
        <div class="card-title">üí¨ –°–æ–æ–±—â–µ—Å—Ç–≤–æ</div>
        <a class="pill pill-cyan pill-sm" id="btn-community" href="#" target="_blank">–û—Ç–∫—Ä—ã—Ç—å</a>
    </div>
    <div class="card card-compact" id="support-help" style="display:none">
        <div class="card-title">üõü –ü–æ–º–æ—â—å</div>
        <a class="pill pill-outline pill-sm" id="btn-support" href="#" target="_blank">–ù–∞–ø–∏—Å–∞—Ç—å</a>
    </div>
</section>

<!-- ‚ïê‚ïê‚ïê TICKET LIST ‚ïê‚ïê‚ïê -->
<section id="p-tickets" class="page">
    <div class="page-header">
        <button class="btn-back" onclick="go('support')">‚Äπ</button>
        <h2 class="page-title">–ú–æ–∏ —Ç–∏–∫–µ—Ç—ã</h2>
        <button class="btn btn-primary btn-sm" onclick="showNewTicket()" style="margin-left:auto">+ –ù–æ–≤—ã–π</button>
    </div>
    <div id="tickets-list" class="ticket-list"></div>
</section>

<!-- ‚ïê‚ïê‚ïê TICKET CHAT ‚ïê‚ïê‚ïê -->
<section id="p-ticket" class="page">
    <div class="page-header">
        <button class="btn-back" onclick="go('tickets');loadTickets()">‚Äπ</button>
        <h2 class="page-title" id="ticket-title">–¢–∏–∫–µ—Ç</h2>
    </div>
    <div id="ticket-chat" class="ticket-chat"></div>
    <div id="ticket-reply" class="ticket-reply-box" style="display:none">
        <textarea id="ticket-text" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶" rows="1"></textarea>
        <button class="ticket-send-btn" onclick="sendTicketReply()">‚Üí</button>
    </div>
    <div id="ticket-close-actions" class="ticket-close-actions" style="display:none">
        <button class="ticket-close-btn resolved" onclick="closeTicket(true)">‚úÖ –í–æ–ø—Ä–æ—Å —Ä–µ—à—ë–Ω</button>
        <button class="ticket-close-btn unresolved" onclick="closeTicket(false)">‚ùå –ù–µ —Ä–µ—à—ë–Ω</button>
    </div>
</section>
<section id="p-profile" class="page">
    <div class="page-header">
        <button class="btn-back" onclick="go('home')">‚Äπ</button>
        <h2 class="page-title">–ü—Ä–æ—Ñ–∏–ª—å</h2>
    </div>
    <div class="card">
        <div class="card-row"><span class="card-label">–ò–º—è</span><span class="card-value" id="pr-name">‚Äî</span></div>
        <div class="card-row"><span class="card-label">Telegram</span><span class="card-value" id="pr-uname">‚Äî</span></div>
        <div class="card-row"><span class="card-label">ID</span><span class="card-value" id="pr-tid">‚Äî</span></div>
        <div class="card-row"><span class="card-label">–ë–∞–ª–∞–Ω—Å</span><span class="card-value" id="pr-balance">‚Äî</span></div>
        <div class="card-row"><span class="card-label">–†–æ–ª—å</span><span class="card-value" id="pr-role">‚Äî</span></div>
    </div>
    <div class="card" id="ref-card" style="display:none">
        <div class="card-title">ü§ù –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞</div>
        <div class="ref-box">
            <code id="ref-link">‚Äî</code>
            <button class="btn btn-primary btn-sm btn-full" onclick="copyRef()" style="margin-top:4px">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
        </div>
    </div>
</section>

<!-- ‚ïê‚ïê‚ïê ADMIN ‚ïê‚ïê‚ïê -->
<section id="p-admin" class="page">
    <div class="page-header">
        <button class="btn-back" onclick="go('home')">‚Äπ</button>
        <h2 class="page-title">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
    </div>
    <div class="admin-tabs" id="adm-tabs">
        <button class="admin-tab active" onclick="admTab('stats')"><span class="tab-icon">üìä</span><span class="tab-label">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span></button>
        <button class="admin-tab" onclick="admTab('users')"><span class="tab-icon">üë•</span><span class="tab-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span></button>
        <button class="admin-tab" onclick="admTab('plans')"><span class="tab-icon">üìã</span><span class="tab-label">–¢–∞—Ä–∏—Ñ—ã</span></button>
        <button class="admin-tab" onclick="admTab('settings')"><span class="tab-icon">‚öôÔ∏è</span><span class="tab-label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span></button>
        <button class="admin-tab" onclick="admTab('tickets')"><span class="tab-icon">üé´</span><span class="tab-label">–¢–∏–∫–µ—Ç—ã</span></button>
        <button class="admin-tab" onclick="admTab('brand')"><span class="tab-icon">üé®</span><span class="tab-label">–ë—Ä–µ–Ω–¥</span></button>
    </div>
    <div id="adm-stats" class="admin-content active">
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-value" id="st-total">‚Äî</div><div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div></div>
            <div class="stat-card"><div class="stat-value" id="st-active">‚Äî</div><div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div></div>
            <div class="stat-card"><div class="stat-value" id="st-expired">‚Äî</div><div class="stat-label">–ò—Å—Ç–µ–∫—à–∏—Ö</div></div>
            <div class="stat-card"><div class="stat-value" id="st-revenue">‚Äî</div><div class="stat-label">–ë–∞–ª–∞–Ω—Å ‚ÇΩ</div></div>
        </div>
    </div>
    <div id="adm-users" class="admin-content">
        <div class="search-box">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            <input id="user-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ / ID" oninput="filterUsers()">
        </div>
        <div id="users-list" class="user-list"></div>
    </div>
    <div id="adm-plans" class="admin-content">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
            <span style="color:var(--text2);font-size:.84rem" id="adm-plans-count">–¢–∞—Ä–∏—Ñ—ã</span>
            <button class="btn btn-primary btn-sm" onclick="showCreatePlan()">+ –°–æ–∑–¥–∞—Ç—å</button>
        </div>
        <div id="adm-plans-list" class="plans-list"></div>
    </div>
    <div id="adm-settings" class="admin-content"><div id="settings-list"></div></div>
    <div id="adm-tickets" class="admin-content">
        <div id="adm-tickets-list" class="ticket-list"></div>
    </div>
    <div id="adm-brand" class="admin-content">
        <div class="card">
            <div class="card-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–µ–Ω–¥–∞</div>
            <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input class="form-input" id="br-name" placeholder="VPN Shop"></div>
            <div class="form-group"><label>–õ–æ–≥–æ—Ç–∏–ø (—ç–º–æ–¥–∑–∏ –∏–ª–∏ URL –∫–∞—Ä—Ç–∏–Ω–∫–∏)</label><input class="form-input" id="br-logo" placeholder="üîê –∏–ª–∏ https://..."></div>
            <div class="form-group"><label>–°–ª–æ–≥–∞–Ω</label><input class="form-input" id="br-slogan" placeholder=""></div>
            <button class="btn btn-primary btn-full" onclick="saveBrand()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</section>

<!-- Admin user detail -->
<section id="p-auser" class="page">
    <div class="page-header">
        <button class="btn-back" onclick="admTab('users');go('admin')">‚Äπ</button>
        <h2 class="page-title" id="aud-title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h2>
    </div>
    <div id="aud-body"></div>
</section>

<!-- Admin ticket detail -->
<section id="p-aticket" class="page">
    <div class="page-header">
        <button class="btn-back" onclick="admTab('tickets');go('admin')">‚Äπ</button>
        <h2 class="page-title" id="at-title">–¢–∏–∫–µ—Ç</h2>
    </div>
    <div id="at-chat" class="ticket-chat"></div>
    <div id="at-reply" class="ticket-reply-box">
        <textarea id="at-text" placeholder="–û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞‚Ä¶" rows="1"></textarea>
        <button class="ticket-send-btn" onclick="sendAdmTicketReply()">‚Üí</button>
    </div>
</section>

</main>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
    <button class="nav-item active" data-p="home" onclick="go('home')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        <span>–ì–ª–∞–≤–Ω–∞—è</span>
    </button>
    <button class="nav-item" data-p="support" onclick="go('support')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
        <span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</span>
    </button>
    <button class="nav-item" data-p="profile" onclick="go('profile')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
    </button>
    <button class="nav-item admin-nav" data-p="admin" onclick="go('admin')" style="display:none">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9c.26.604.852.997 1.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
        <span>–ê–¥–º–∏–Ω</span>
    </button>
</nav>

</div>

<button class="ticket-fab" id="ticket-fab" onclick="go('tickets')" title="–û–±—Ä–∞—â–µ–Ω–∏—è" style="display:none">üí¨<span class="fab-badge" id="fab-badge"></span></button>
<div id="modal-root"></div>
<div id="toast" class="toast"></div>
{% endblock %}

{% block scripts %}
<script>
const API='/web', D={{ data_json | safe }};
let BRAND={name:'',logo:'üîê',slogan:''};
let IS_ADMIN=D.user.role==='DEV'||D.user.role==='ADMIN';
let usersCache=[],curAdmTab='stats';
const AVAIL_LABELS={ALL:'–í—Å–µ',NEW:'–ù–æ–≤—ã–µ',EXISTING:'–î–µ–π—Å—Ç–≤—É—é—â–∏–µ',INVITED:'–ü—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ',ALLOWED:'–†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ',TRIAL:'–ü—Ä–æ–±–Ω—ã–π'};
const TYPE_LABELS={TRAFFIC:'–¢—Ä–∞—Ñ–∏–∫',DEVICES:'–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞',BOTH:'–¢—Ä–∞—Ñ–∏–∫+–£—Å—Ç—Ä.',UNLIMITED:'–ë–µ–∑–ª–∏–º–∏—Ç'};
const CURRENCY_SYMBOLS={USD:'$',EUR:'‚Ç¨',XTR:'‚òÖ',RUB:'‚ÇΩ'};

/* ‚îÄ‚îÄ i18n ‚îÄ‚îÄ */
const I18N={
    RU:{
        home:'–ì–ª–∞–≤–Ω–∞—è',support:'–ü–æ–¥–¥–µ—Ä–∂–∫–∞',profile:'–ü—Ä–æ—Ñ–∏–ª—å',admin:'–ê–¥–º–∏–Ω',
        buy:'–ö—É–ø–∏—Ç—å',trial:'–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ',connect:'–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å',
        promo:'–ü—Ä–æ–º–æ–∫–æ–¥—ã',devices:'–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞',plans:'–¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã',
        connect_title:'–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ',devices_title:'–ú–æ–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞',
        sub_link:'–°—Å—ã–ª–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏',copy:'–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å',download:'–°–∫–∞—á–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
        no_sub:'–ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏',active:'–ê–∫—Ç–∏–≤–Ω–∞',expired:'–ò—Å—Ç–µ–∫–ª–∞',trial_period:'–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥',
        limit:'–õ–∏–º–∏—Ç',used:'–ó–∞–Ω—è—Ç–æ',expand_devices:'–†–∞—Å—à–∏—Ä–∏—Ç—å —Å–ª–æ—Ç—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤',
        activate_promo:'–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥',enter_code:'–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥',
        tickets:'–¢–∏–∫–µ—Ç—ã',community:'–°–æ–æ–±—â–µ—Å—Ç–≤–æ',help:'–ü–æ–º–æ—â—å',open:'–û—Ç–∫—Ä—ã—Ç—å',write:'–ù–∞–ø–∏—Å–∞—Ç—å',
        my_tickets:'–ú–æ–∏ —Ç–∏–∫–µ—Ç—ã',new_ticket:'–ù–æ–≤—ã–π',
        name:'–ò–º—è',telegram:'Telegram',balance:'–ë–∞–ª–∞–Ω—Å',role:'–†–æ–ª—å',
        invite_friend:'–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞',copy_link:'–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É',
        remains:'–û—Å—Ç–∞–ª–æ—Å—å',days_left:'–¥–Ω.',
        select_period:'–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥:',cancel:'–û—Ç–º–µ–Ω–∞',close:'–ó–∞–∫—Ä—ã—Ç—å',
        active_sub_note:'–£ –≤–∞—Å –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞. –û–ø–ª–∞—Ç–∞ –±—É–¥–µ—Ç —Å–ø–∏—Å–∞–Ω–∞ —Å –±–∞–ª–∞–Ω—Å–∞.',
        not_enough:'–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –ë–∞–ª–∞–Ω—Å:',processing:'–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∫—É–ø–∫–∏‚Ä¶',
        sub_done:'–ü–æ–¥–ø–∏—Å–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞!',purchase_error:'–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏',net_error:'–û—à–∏–±–∫–∞ —Å–µ—Ç–∏',
        trial_activating:'–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–±–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏‚Ä¶',trial_done:'–ü—Ä–æ–±–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!',
        trial_go_connect:'–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª ¬´–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ¬ª –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.',
        setup:'–ù–∞—Å—Ç—Ä–æ–∏—Ç—å',expand_unavail:'–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ',
        expand_trial_msg:'–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–ª–æ—Ç–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ –ø—Ä–æ–±–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–µ. –ü—Ä–∏–æ–±—Ä–µ—Ç–∏—Ç–µ –ø–æ–ª–Ω—ã–π —Ç–∞—Ä–∏—Ñ.',
        buy_plan:'–ö—É–ø–∏—Ç—å —Ç–∞—Ä–∏—Ñ',
        no_plans:'–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤',loading:'–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶',error:'–û—à–∏–±–∫–∞',
        savings:'–í—ã–≥–æ–¥–∞',
        new_ticket_title:'–ù–æ–≤—ã–π —Ç–∏–∫–µ—Ç',subject:'–¢–µ–º–∞',message:'–°–æ–æ–±—â–µ–Ω–∏–µ',send:'–û—Ç–ø—Ä–∞–≤–∏—Ç—å',
        fill_all:'–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è',ticket_created:'–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω',
        resolved:'–í–æ–ø—Ä–æ—Å —Ä–µ—à—ë–Ω',unresolved:'–ù–µ —Ä–µ—à—ë–Ω',
        ticket_closed_resolved:'–¢–∏–∫–µ—Ç –∑–∞–∫—Ä—ã—Ç –∫–∞–∫ —Ä–µ—à—ë–Ω–Ω—ã–π',ticket_closed_unresolved:'–¢–∏–∫–µ—Ç –∑–∞–∫—Ä—ã—Ç –∫–∞–∫ –Ω–µ—Ä–µ—à—ë–Ω–Ω—ã–π',
        copied:'–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!',link_copied:'–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!',no_sub_err:'–ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏',
        user_role:'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',admin_role:'–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',dev_role:'–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫',
        agreement:'–û—Ñ–µ—Ä—Ç–∞',no_tickets:'–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤',create_first:'–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–∏–∫–µ—Ç',
        write_msg:'–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶',
        traffic:'–¢—Ä–∞—Ñ–∏–∫',dev_short:'—É—Å—Ç—Ä.',select_plan:'–í—ã–±—Ä–∞—Ç—å —Ç–∞—Ä–∏—Ñ',to_date:'–¥–æ',topup:'–ü–æ–ø–æ–ª–Ω–∏—Ç—å',
        topup_via_bot:'–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞',expand_via_bot:'–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞',
        promo_activated:'–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!',quick_connect:'–ë—ã—Å—Ç—Ä–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ',one_click:'–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –≤ –æ–¥–∏–Ω –∫–ª–∏–∫',
        sub_page:'–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–ø–∏—Å–∫–∏',no_active_sub:'–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏',saved:'–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ',
    },
    EN:{
        home:'Home',support:'Support',profile:'Profile',admin:'Admin',
        buy:'Buy',trial:'Try for free',connect:'Install & Setup',
        promo:'Promo codes',devices:'Devices',plans:'Plans',
        connect_title:'Connection',devices_title:'My Devices',
        sub_link:'Subscription Link',copy:'Copy',download:'Download App',
        no_sub:'No subscription',active:'Active',expired:'Expired',trial_period:'Trial',
        limit:'Limit',used:'Used',expand_devices:'Expand device slots',
        activate_promo:'Activate promo code',enter_code:'Enter code',
        tickets:'Tickets',community:'Community',help:'Help',open:'Open',write:'Write',
        my_tickets:'My Tickets',new_ticket:'New',
        name:'Name',telegram:'Telegram',balance:'Balance',role:'Role',
        invite_friend:'Invite a friend',copy_link:'Copy link',
        remains:'Remaining',days_left:'d.',
        select_period:'Choose period:',cancel:'Cancel',close:'Close',
        active_sub_note:'You have an active subscription. Payment will be deducted from balance.',
        not_enough:'Not enough funds. Balance:',processing:'Processing purchase‚Ä¶',
        sub_done:'Subscription activated!',purchase_error:'Purchase error',net_error:'Network error',
        trial_activating:'Activating trial subscription‚Ä¶',trial_done:'Trial subscription activated!',
        trial_go_connect:'Go to "Connection" section to configure.',
        setup:'Setup',expand_unavail:'Unavailable',
        expand_trial_msg:'Device expansion is not available on trial. Purchase a full plan.',
        buy_plan:'Buy plan',
        no_plans:'No available plans',loading:'Loading‚Ä¶',error:'Error',
        savings:'Save',
        new_ticket_title:'New Ticket',subject:'Subject',message:'Message',send:'Send',
        fill_all:'Fill in all fields',ticket_created:'Ticket created',
        resolved:'Resolved',unresolved:'Not resolved',
        ticket_closed_resolved:'Ticket closed as resolved',ticket_closed_unresolved:'Ticket closed as unresolved',
        copied:'Copied!',link_copied:'Link copied!',no_sub_err:'No subscription',
        user_role:'User',admin_role:'Administrator',dev_role:'Developer',
        agreement:'Terms',no_tickets:'No tickets',create_first:'Create your first ticket',
        write_msg:'Write a message‚Ä¶',
        traffic:'Traffic',dev_short:'dev.',select_plan:'Select plan',to_date:'until',topup:'Top up',
        topup_via_bot:'Top up balance via bot',expand_via_bot:'Device expansion available via bot',
        promo_activated:'Promo code activated!',quick_connect:'Quick connect',one_click:'One-click connect',
        sub_page:'Subscription page',no_active_sub:'No active subscription',saved:'Saved',
    },
    UK:{
        home:'–ì–æ–ª–æ–≤–Ω–∞',support:'–ü—ñ–¥—Ç—Ä–∏–º–∫–∞',profile:'–ü—Ä–æ—Ñ—ñ–ª—å',admin:'–ê–¥–º—ñ–Ω',
        buy:'–ö—É–ø–∏—Ç–∏',trial:'–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ',connect:'–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏',
        promo:'–ü—Ä–æ–º–æ–∫–æ–¥–∏',devices:'–ü—Ä–∏—Å—Ç—Ä–æ—ó',plans:'–¢–∞—Ä–∏—Ñ–Ω—ñ –ø–ª–∞–Ω–∏',
        connect_title:'–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è',devices_title:'–ú–æ—ó –ø—Ä–∏—Å—Ç—Ä–æ—ó',
        sub_link:'–ü–æ—Å–∏–ª–∞–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–∫–∏',copy:'–ö–æ–ø—ñ—é–≤–∞—Ç–∏',download:'–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫',
        no_sub:'–ù–µ–º–∞—î –ø—ñ–¥–ø–∏—Å–∫–∏',active:'–ê–∫—Ç–∏–≤–Ω–∞',expired:'–ó–∞–∫—ñ–Ω—á–∏–ª–∞—Å—å',trial_period:'–ü—Ä–æ–±–Ω–∏–π –ø–µ—Ä—ñ–æ–¥',
        limit:'–õ—ñ–º—ñ—Ç',used:'–ó–∞–π–Ω—è—Ç–æ',expand_devices:'–†–æ–∑—à–∏—Ä–∏—Ç–∏ —Å–ª–æ—Ç–∏ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤',
        activate_promo:'–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥',enter_code:'–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥',
        tickets:'–¢—ñ–∫–µ—Ç–∏',community:'–°–ø—ñ–ª—å–Ω–æ—Ç–∞',help:'–î–æ–ø–æ–º–æ–≥–∞',open:'–í—ñ–¥–∫—Ä–∏—Ç–∏',write:'–ù–∞–ø–∏—Å–∞—Ç–∏',
        my_tickets:'–ú–æ—ó —Ç—ñ–∫–µ—Ç–∏',new_ticket:'–ù–æ–≤–∏–π',
        name:'–Ü–º º—è',telegram:'Telegram',balance:'–ë–∞–ª–∞–Ω—Å',role:'–†–æ–ª—å',
        invite_friend:'–ó–∞–ø—Ä–æ—Å–∏—Ç–∏ –¥—Ä—É–≥–∞',copy_link:'–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è',
        remains:'–ó–∞–ª–∏—à–∏–ª–æ—Å—å',days_left:'–¥–Ω.',
        select_period:'–û–±–µ—Ä—ñ—Ç—å –ø–µ—Ä—ñ–æ–¥:',cancel:'–°–∫–∞—Å—É–≤–∞—Ç–∏',close:'–ó–∞–∫—Ä–∏—Ç–∏',
        active_sub_note:'–£ –≤–∞—Å —î –∞–∫—Ç–∏–≤–Ω–∞ –ø—ñ–¥–ø–∏—Å–∫–∞. –û–ø–ª–∞—Ç–∞ –±—É–¥–µ —Å–ø–∏—Å–∞–Ω–∞ –∑ –±–∞–ª–∞–Ω—Å—É.',
        not_enough:'–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤. –ë–∞–ª–∞–Ω—Å:',processing:'–û–±—Ä–æ–±–∫–∞ –ø–æ–∫—É–ø–∫–∏‚Ä¶',
        sub_done:'–ü—ñ–¥–ø–∏—Å–∫—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ!',purchase_error:'–ü–æ–º–∏–ª–∫–∞ –ø–æ–∫—É–ø–∫–∏',net_error:'–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ',
        trial_activating:'–ê–∫—Ç–∏–≤–∞—Ü—ñ—è –ø—Ä–æ–±–Ω–æ—ó –ø—ñ–¥–ø–∏—Å–∫–∏‚Ä¶',trial_done:'–ü—Ä–æ–±–Ω—É –ø—ñ–¥–ø–∏—Å–∫—É –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!',
        trial_go_connect:'–ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ —Ä–æ–∑–¥—ñ–ª—É ¬´–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è¬ª –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è.',
        setup:'–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏',expand_unavail:'–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ',
        expand_trial_msg:'–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Å–ª–æ—Ç—ñ–≤ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ –≤ –ø—Ä–æ–±–Ω—ñ–π –ø—ñ–¥–ø–∏—Å—Ü—ñ. –ü—Ä–∏–¥–±–∞–π—Ç–µ –ø–æ–≤–Ω–∏–π —Ç–∞—Ä–∏—Ñ.',
        buy_plan:'–ö—É–ø–∏—Ç–∏ —Ç–∞—Ä–∏—Ñ',
        no_plans:'–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Ç–∞—Ä–∏—Ñ—ñ–≤',loading:'–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶',error:'–ü–æ–º–∏–ª–∫–∞',
        savings:'–í–∏–≥–æ–¥–∞',
        new_ticket_title:'–ù–æ–≤–∏–π —Ç—ñ–∫–µ—Ç',subject:'–¢–µ–º–∞',message:'–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è',send:'–ù–∞–¥—ñ—Å–ª–∞—Ç–∏',
        fill_all:'–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è',ticket_created:'–¢—ñ–∫–µ—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ',
        resolved:'–ü–∏—Ç–∞–Ω–Ω—è –≤–∏—Ä—ñ—à–µ–Ω–æ',unresolved:'–ù–µ –≤–∏—Ä—ñ—à–µ–Ω–æ',
        ticket_closed_resolved:'–¢—ñ–∫–µ—Ç –∑–∞–∫—Ä–∏—Ç–æ —è–∫ –≤–∏—Ä—ñ—à–µ–Ω–∏–π',ticket_closed_unresolved:'–¢—ñ–∫–µ—Ç –∑–∞–∫—Ä–∏—Ç–æ —è–∫ –Ω–µ–≤–∏—Ä—ñ—à–µ–Ω–∏–π',
        copied:'–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!',link_copied:'–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!',no_sub_err:'–ù–µ–º–∞—î –ø—ñ–¥–ø–∏—Å–∫–∏',
        user_role:'–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á',admin_role:'–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä',dev_role:'–†–æ–∑—Ä–æ–±–Ω–∏–∫',
        agreement:'–û—Ñ–µ—Ä—Ç–∞',no_tickets:'–ù–µ–º–∞—î —Ç—ñ–∫–µ—Ç—ñ–≤',create_first:'–°—Ç–≤–æ—Ä—ñ—Ç—å –ø–µ—Ä—à–∏–π —Ç—ñ–∫–µ—Ç',
        write_msg:'–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è‚Ä¶',
        traffic:'–¢—Ä–∞—Ñ—ñ–∫',dev_short:'–ø—Ä–∏—Å—Ç—Ä.',select_plan:'–û–±—Ä–∞—Ç–∏ —Ç–∞—Ä–∏—Ñ',to_date:'–¥–æ',topup:'–ü–æ–ø–æ–≤–Ω–∏—Ç–∏',
        topup_via_bot:'–ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É –¥–æ—Å—Ç—É–ø–Ω–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞',expand_via_bot:'–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ –¥–æ—Å—Ç—É–ø–Ω–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞',
        promo_activated:'–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!',quick_connect:'–®–≤–∏–¥–∫–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è',one_click:'–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –≤ –æ–¥–∏–Ω –∫–ª—ñ–∫',
        sub_page:'–°—Ç–æ—Ä—ñ–Ω–∫–∞ –ø—ñ–¥–ø–∏—Å–∫–∏',no_active_sub:'–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ—ó –ø—ñ–¥–ø–∏—Å–∫–∏',saved:'–ó–±–µ—Ä–µ–∂–µ–Ω–æ',
    },
    DE:{
        home:'Startseite',support:'Support',profile:'Profil',admin:'Admin',
        buy:'Kaufen',trial:'Kostenlos testen',connect:'Installieren & Einrichten',
        promo:'Promocodes',devices:'Ger√§te',plans:'Tarife',
        connect_title:'Verbindung',devices_title:'Meine Ger√§te',
        sub_link:'Abo-Link',copy:'Kopieren',download:'App herunterladen',
        no_sub:'Kein Abo',active:'Aktiv',expired:'Abgelaufen',trial_period:'Testphase',
        limit:'Limit',used:'Belegt',expand_devices:'Ger√§teslots erweitern',
        activate_promo:'Promocode aktivieren',enter_code:'Code eingeben',
        tickets:'Tickets',community:'Community',help:'Hilfe',open:'√ñffnen',write:'Schreiben',
        my_tickets:'Meine Tickets',new_ticket:'Neu',
        name:'Name',telegram:'Telegram',balance:'Guthaben',role:'Rolle',
        invite_friend:'Freund einladen',copy_link:'Link kopieren',
        remains:'Verbleibend',days_left:'T.',
        select_period:'Zeitraum w√§hlen:',cancel:'Abbrechen',close:'Schlie√üen',
        active_sub_note:'Sie haben ein aktives Abo. Zahlung wird vom Guthaben abgezogen.',
        not_enough:'Nicht genug Guthaben. Saldo:',processing:'Kauf wird bearbeitet‚Ä¶',
        sub_done:'Abo abgeschlossen!',purchase_error:'Kauffehler',net_error:'Netzwerkfehler',
        trial_activating:'Test-Abo wird aktiviert‚Ä¶',trial_done:'Test-Abo aktiviert!',
        trial_go_connect:'Gehen Sie zum Abschnitt "Verbindung" zur Einrichtung.',
        setup:'Einrichten',expand_unavail:'Nicht verf√ºgbar',
        expand_trial_msg:'Ger√§teerweiterung im Testabo nicht verf√ºgbar. Erwerben Sie einen vollen Tarif.',
        buy_plan:'Tarif kaufen',
        no_plans:'Keine verf√ºgbaren Tarife',loading:'Laden‚Ä¶',error:'Fehler',
        savings:'Ersparnis',
        new_ticket_title:'Neues Ticket',subject:'Betreff',message:'Nachricht',send:'Senden',
        fill_all:'Alle Felder ausf√ºllen',ticket_created:'Ticket erstellt',
        resolved:'Gel√∂st',unresolved:'Nicht gel√∂st',
        ticket_closed_resolved:'Ticket als gel√∂st geschlossen',ticket_closed_unresolved:'Ticket als ungel√∂st geschlossen',
        copied:'Kopiert!',link_copied:'Link kopiert!',no_sub_err:'Kein Abo',
        user_role:'Benutzer',admin_role:'Administrator',dev_role:'Entwickler',
        agreement:'AGB',no_tickets:'Keine Tickets',create_first:'Erstellen Sie Ihr erstes Ticket',
        write_msg:'Nachricht schreiben‚Ä¶',
        traffic:'Traffic',dev_short:'Ger.',select_plan:'Tarif w√§hlen',to_date:'bis',topup:'Aufladen',
        topup_via_bot:'Guthaben √ºber Bot aufladen',expand_via_bot:'Ger√§teerweiterung √ºber Bot verf√ºgbar',
        promo_activated:'Promocode aktiviert!',quick_connect:'Schnellverbindung',one_click:'Ein-Klick-Verbindung',
        sub_page:'Abo-Seite',no_active_sub:'Kein aktives Abo',saved:'Gespeichert',
    }
};
let CUR_LOCALE='RU';
function t(k){return (I18N[CUR_LOCALE]||I18N.RU)[k]||(I18N.RU[k]||k)}
function applyLocale(){
    document.querySelectorAll('.nav-item').forEach(b=>{
        const pg=b.dataset.p;
        if(pg==='home') b.querySelector('span').textContent=t('home');
        if(pg==='support') b.querySelector('span').textContent=t('support');
        if(pg==='profile') b.querySelector('span').textContent=t('profile');
        if(pg==='admin') b.querySelector('span').textContent=t('admin');
    });
    const hp=$('p-home');
    if(hp){
        const trial=$('btn-trial');if(trial)trial.innerHTML='üéÅ&nbsp; '+t('trial');
        hp.querySelectorAll('.pill').forEach(p=>{
            const oc=p.getAttribute('onclick')||'';
            if(oc.includes("go('plans')")) p.innerHTML='üõí&nbsp; '+t('buy');
            if(oc.includes("go('connect')")) p.innerHTML='‚äô&nbsp; '+t('connect');
            if(oc.includes("go('promo')")) p.innerHTML='üéÅ '+t('promo');
            if(oc.includes("go('devices')")) p.innerHTML='üì± '+t('devices');
        });
    }
    const pts={'p-plans':'plans','p-connect':'connect_title','p-devices':'devices_title','p-promo':'promo','p-support':'support','p-tickets':'my_tickets','p-profile':'profile'};
    Object.entries(pts).forEach(([id,key])=>{const el=$(id);if(el){const tt=el.querySelector('.page-title');if(tt)tt.textContent=t(key)}});
    const cp=$('p-connect');
    if(cp){
        const titles=cp.querySelectorAll('.card-title');
        if(titles[0])titles[0].textContent=t('sub_link');
        if(titles[1])titles[1].textContent=t('download');
        const copyBtn=cp.querySelector('.connect-box button');if(copyBtn)copyBtn.textContent=t('copy');
    }
    const dp=$('p-devices');
    if(dp){
        const labels=dp.querySelectorAll('.card-label');
        if(labels[0])labels[0].textContent=t('limit');
        if(labels[1])labels[1].textContent=t('used');
        const eb=$('btn-expand-devices');if(eb)eb.innerHTML='‚ûï '+t('expand_devices');
    }
    const pp=$('p-promo');
    if(pp){
        const ct=pp.querySelector('.card-title');if(ct)ct.textContent=t('activate_promo');
        const inp=$('promo-input');if(inp)inp.placeholder=t('enter_code');
    }
    const sp=$('p-support');
    if(sp){
        const cards=sp.querySelectorAll('.card');
        cards.forEach(c=>{
            const ct=c.querySelector('.card-title');if(!ct)return;
            if(ct.textContent.includes('üé´')||ct.querySelector('#ticket-badge')){ct.childNodes[0].textContent='üé´ '+t('tickets')+' '}
            if(ct.textContent.includes('üí¨')) ct.textContent='üí¨ '+t('community');
            if(ct.textContent.includes('üõü')) ct.textContent='üõü '+t('help');
        });
        sp.querySelectorAll('.pill').forEach(p=>{
            const oc=p.getAttribute('onclick')||'',id=p.id||'';
            if(oc.includes("go('tickets')")) p.textContent=t('open');
            if(id==='btn-community') p.textContent=t('open');
            if(id==='btn-support') p.textContent=t('write');
        });
    }
    const tp=$('p-tickets');
    if(tp){const nb=tp.querySelector('.btn');if(nb)nb.textContent='+ '+t('new_ticket')}
    const ttext=$('ticket-text');if(ttext)ttext.placeholder=t('write_msg');
    const cbtns=$('ticket-close-actions');
    if(cbtns){
        const btns=cbtns.querySelectorAll('.ticket-close-btn');
        if(btns[0])btns[0].innerHTML='‚úÖ '+t('resolved');
        if(btns[1])btns[1].innerHTML='‚ùå '+t('unresolved');
    }
    const pf=$('p-profile');
    if(pf){
        const labels=pf.querySelectorAll('.card-label');
        if(labels[0])labels[0].textContent=t('name');
        if(labels[1])labels[1].textContent=t('telegram');
        if(labels[2])labels[2].textContent='ID';
        if(labels[3])labels[3].textContent=t('balance');
        if(labels[4])labels[4].textContent=t('role');
        pf.querySelectorAll('.card-title').forEach(ct=>{
            if(ct.textContent.includes('ü§ù'))ct.textContent='ü§ù '+t('invite_friend');
        });
        pf.querySelectorAll('.pill,.btn').forEach(p=>{
            if((p.getAttribute('onclick')||'').includes('copyRef'))p.textContent=t('copy_link');
        });
    }
}

/* ‚îÄ‚îÄ INIT ‚îÄ‚îÄ */
(async function(){
    initParticles();
    try{const br=await fetch(API+'/api/settings/brand');if(br.ok)BRAND=await br.json()}catch(e){}
    // Set locale from bot_locale or user language
    const bl=(D.bot_locale||'').toUpperCase();
    if(['RU','EN','UK','DE'].includes(bl)) CUR_LOCALE=bl;
    else {
        const ul=(D.user.language||'').toUpperCase();
        if(['RU','EN','UK','DE'].includes(ul)) CUR_LOCALE=ul;
    }
    if(IS_ADMIN) document.querySelectorAll('.admin-nav').forEach(e=>e.style.display='');
    render();
    applyLocale();
    // Start polling ticket status every 15 seconds
    setInterval(pollTicketStatus, 15000);
})();

function initParticles(){
    if(typeof particlesJS!=='undefined'){
        particlesJS('particles-js',{
            particles:{
                number:{value:60,density:{enable:true,value_area:800}},
                color:{value:'#24C4F1'},
                shape:{type:'circle'},
                opacity:{value:0.25,random:true,anim:{enable:false}},
                size:{value:2,random:true,anim:{enable:false}},
                line_linked:{enable:true,distance:180,color:'#24C4F1',opacity:0.08,width:1},
                move:{enable:true,speed:0.6,direction:'none',random:false,straight:false,out_mode:'out',bounce:false}
            },
            interactivity:{
                detect_on:'window',
                events:{onhover:{enable:true,mode:'grab'},onclick:{enable:true,mode:'push'},resize:true},
                modes:{grab:{distance:140,line_linked:{opacity:0.3}},push:{particles_nb:1}}
            },
            retina_detect:true
        });
    }
}

function $(id){return document.getElementById(id)}

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
let curPage='home';
function go(p){
    curPage=p;
    document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));
    $('p-'+p).classList.add('active');
    document.querySelectorAll('.nav-item').forEach(b=>b.classList.toggle('active',b.dataset.p===p));
    if(p==='admin')loadAdm(curAdmTab);
    if(p==='plans')renderPlans();
    if(p==='tickets')loadTickets();
    updateFab();
}
function updateFab(){
    const fab=$('ticket-fab'), badge=$('fab-badge');
    if(curPage==='home' && D.has_open_tickets){
        fab.style.display='flex';
        if(D.ticket_unread>0){
            fab.classList.add('has-reply');
            badge.textContent=D.ticket_unread;
            badge.style.display='flex';
        } else {
            fab.classList.remove('has-reply');
            badge.style.display='none';
        }
    } else {
        fab.style.display='none';
        fab.classList.remove('has-reply');
        badge.style.display='none';
    }
}
async function pollTicketStatus(){
    try{
        const r=await fetch(API+'/api/tickets/status');
        if(!r.ok)return;
        const s=await r.json();
        D.has_open_tickets=s.has_open;
        D.ticket_unread=s.unread;
        updateFab();
    }catch(e){}
}

/* ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ */
function render(){
    // Brand logo: URL ‚Üí <img>, otherwise emoji text
    const logoEl=$('brand-logo');
    const logoVal=BRAND.logo||'üîê';
    if(logoVal.startsWith('http')){logoEl.innerHTML='<img class="brand-logo-img" src="'+esc(logoVal)+'" alt="">';logoEl.classList.add('has-img')}
    else{logoEl.textContent=logoVal;logoEl.classList.remove('has-img')}
    $('brand-name').textContent=BRAND.name||'–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç';
    const sloganEl=$('brand-slogan');
    if(BRAND.slogan){sloganEl.textContent=BRAND.slogan;sloganEl.style.display=''}else{sloganEl.style.display='none'}
    renderSub();renderConnect();renderProfile();renderSupport();
    // Trial button
    if(D.trial_available) $('btn-trial').style.display='';
    else $('btn-trial').style.display='none';
    // Ticket FAB ‚Äî only on home page, only for open (non-closed/resolved) tickets
    updateFab();
    // Ticket badge
    if(D.ticket_unread>0){$('ticket-badge').style.display='';$('ticket-badge').textContent=D.ticket_unread}
    // Expand devices button
    if(D.subscription&&D.subscription.status==='ACTIVE') $('btn-expand-devices').style.display='';
}

function renderSub(){
    const s=D.subscription,b=$('sub-badge'),e=$('sub-expire'),tr=$('sub-traffic');
    if(!s||!s.status){b.textContent=t('no_sub');b.className='sub-badge sub-badge-none';e.textContent='';tr.innerHTML='';return}
    if(s.is_trial){b.textContent=t('trial_period');b.className='sub-badge sub-badge-trial'}
    else if(s.status==='ACTIVE'){b.textContent=t('active');b.className='sub-badge sub-badge-active'}
    else if(s.status==='EXPIRED'){b.textContent=t('expired');b.className='sub-badge sub-badge-expired'}
    else{b.textContent=s.status;b.className='sub-badge sub-badge-none'}
    e.innerHTML=s.expire_at?'üìÖ '+t('to_date')+' '+s.expire_at:'';
    if(s.expire_at && (s.status==='ACTIVE' || s.is_trial)){
        const daysLeft=Math.ceil((new Date(s.expire_at)-new Date())/(1000*60*60*24));
        if(daysLeft>=0) e.innerHTML+='<div style="font-size:.76rem;color:var(--text3);margin-top:2px">'+t('remains')+' '+daysLeft+' '+ pluralDays(daysLeft)+'</div>';
    }
    const tl=s.traffic_limit?s.traffic_limit+' GB':'‚àû';
    tr.innerHTML=t('traffic')+' <b>0 B / '+tl+'</b>';
}

function renderPlans(){
    const el=$('plans-list'), dc=D.default_currency||'RUB', sym=CURRENCY_SYMBOLS[dc]||'‚ÇΩ';
    if(!D.plans||!D.plans.length){el.innerHTML='<div class="empty-state"><span class="empty-icon">üìã</span><h3>'+t('no_plans')+'</h3></div>';return}
    // Find base price-per-day for discount calc
    let basePpd=null;
    D.plans.forEach(p=>{
        (p.durations||[]).forEach(d=>{
            const pr=findPrice(d,dc);
            if(pr!==null && d.days>0){
                const ppd=pr/d.days;
                if(basePpd===null||d.days<=(basePpd.days||9999)){basePpd={ppd,days:d.days}}
            }
        });
    });

    el.innerHTML=D.plans.map(p=>{
        const durs=(p.durations||[]).map(d=>{
            const pr=findPrice(d,dc);
            if(pr===null) return '';
            let savingsHtml='';
            if(basePpd && d.days>basePpd.days && pr>0){
                const ppd=pr/d.days;
                const pct=Math.round((1-ppd/basePpd.ppd)*100);
                if(pct>0) savingsHtml='<span class="plan-savings">('+t('savings')+' '+pct+'%)</span>';
            }
            return '<div class="plan-duration"><span class="plan-days">'+fmtDays(d.days)+'</span><span class="plan-price">'+pr+' '+sym+' '+savingsHtml+'</span></div>';
        }).join('');
        return '<div class="card plan-card" onclick="selectPlan('+p.id+')"><h3 class="plan-name">'+esc(p.name)+'</h3><div class="plan-info"><span>üì¶ '+(p.traffic_limit||'‚àû')+' GB</span><span>üì± '+(p.device_limit||'‚àû')+' '+t('dev_short')+'</span></div><div class="plan-durations">'+durs+'</div><button class="plan-buy-btn" onclick="event.stopPropagation();selectPlan('+p.id+')">'+t('select_plan')+'</button></div>';
    }).join('');
}

function findPrice(dur,currency){
    const p=(dur.prices||[]).find(x=>x.currency===currency);
    return p?parseFloat(p.amount):null;
}
function fmtDays(d){
    if(d<=0)return '‚àû';
    const l=CUR_LOCALE;
    if(l==='EN'){if(d===1)return '1 day';if(d===7)return '7 days';if(d===30)return '1 mo.';if(d===60)return '2 mo.';if(d===90)return '3 mo.';if(d===180)return '6 mo.';if(d===365)return '1 year';return d+' d.'}
    if(l==='UK'){if(d===1)return '1 –¥–µ–Ω—å';if(d===7)return '7 –¥–Ω—ñ–≤';if(d===30)return '1 –º—ñ—Å.';if(d===60)return '2 –º—ñ—Å.';if(d===90)return '3 –º—ñ—Å.';if(d===180)return '6 –º—ñ—Å.';if(d===365)return '1 —Ä—ñ–∫';return d+' –¥–Ω.'}
    if(l==='DE'){if(d===1)return '1 Tag';if(d===7)return '7 Tage';if(d===30)return '1 Mon.';if(d===60)return '2 Mon.';if(d===90)return '3 Mon.';if(d===180)return '6 Mon.';if(d===365)return '1 Jahr';return d+' T.'}
    if(d===1)return '1 –¥–µ–Ω—å';if(d===7)return '7 –¥–Ω–µ–π';if(d===30)return '1 –º–µ—Å.';if(d===60)return '2 –º–µ—Å.';if(d===90)return '3 –º–µ—Å.';if(d===180)return '6 –º–µ—Å.';if(d===365)return '1 –≥–æ–¥';return d+' –¥–Ω.';
}

function renderConnect(){
    const s=D.subscription;
    $('con-url').textContent=(s&&s.url)?s.url:t('no_active_sub');
    const dl=s&&s.device_limit;
    $('dev-limit').textContent=dl||'‚Äî';
    $('dev-used').textContent='‚Äî';
}

function renderProfile(){
    const u=D.user, sym=CURRENCY_SYMBOLS[D.default_currency]||'‚ÇΩ';
    $('pr-name').textContent=u.name||'‚Äî';
    $('pr-uname').textContent=u.username?'@'+u.username:'‚Äî';
    $('pr-tid').textContent=u.telegram_id;
    $('pr-balance').textContent=u.balance+' '+sym;
    const rm={USER:t('user_role'),ADMIN:t('admin_role'),DEV:t('dev_role')};
    $('pr-role').textContent=rm[u.role]||u.role;
    if(D.features&&D.features.referral_enabled!==false){
        $('ref-card').style.display='';
        const bot=D.bot_username||'bot';
        $('ref-link').textContent='https://t.me/'+bot+'?start=ref_'+u.telegram_id;
    }
}

function renderSupport(){
    if(D.features){
        if(D.features.community_enabled&&D.features.community_url){
            $('support-community').style.display='';
            $('btn-community').href=D.features.community_url;
        }
    }
    if(D.support_url){
        $('support-help').style.display='';
        $('btn-support').href=D.support_url;
    }
}

/* ‚îÄ‚îÄ ACTIONS ‚îÄ‚îÄ */
function selectPlan(id){
    const plan=D.plans.find(p=>p.id===id);if(!plan)return;
    const dc=D.default_currency||'RUB', sym=CURRENCY_SYMBOLS[dc]||'‚ÇΩ';
    let basePpd=null;
    (plan.durations||[]).forEach(d=>{
        const pr=findPrice(d,dc);
        if(pr!==null && d.days>0){
            const ppd=pr/d.days;
            if(basePpd===null||d.days<=(basePpd.days||9999)){basePpd={ppd,days:d.days}}
        }
    });
    const dursHtml=(plan.durations||[]).map(d=>{
        const pr=findPrice(d,dc);if(pr===null)return '';
        let savBadge='';
        if(basePpd && d.days>basePpd.days && pr>0){
            const ppd=pr/d.days;
            const pct=Math.round((1-ppd/basePpd.ppd)*100);
            if(pct>0) savBadge='<span class="plan-savings" style="margin-left:auto">('+t('savings')+' '+pct+'%)</span>';
        }
        return '<div class="plan-duration" style="cursor:pointer;transition:all .2s" onclick="confirmPurchase('+id+','+d.days+','+pr+')" onmouseover="this.style.borderColor=\'var(--cyan-border)\'" onmouseout="this.style.borderColor=\'var(--border)\'"><span class="plan-days">'+fmtDays(d.days)+'</span><span class="plan-price">'+pr+' '+sym+'</span>'+savBadge+'</div>';
    }).join('');
    let purchaseNote='';
    if(D.subscription&&D.subscription.status==='ACTIVE'){
        purchaseNote='<p style="color:var(--gold);font-size:.8rem;margin-top:8px">‚ö†Ô∏è '+t('active_sub_note')+'</p>';
    }
    showModal('<h3>'+esc(plan.name)+'</h3><p style="color:var(--text3);font-size:.84rem;margin-bottom:8px">'+t('select_period')+'</p><div class="plan-durations" style="gap:6px">'+dursHtml+'</div>'+purchaseNote+'<div class="modal-actions"><button class="btn btn-secondary" onclick="closeModal()">'+t('cancel')+'</button></div>');
}
async function confirmPurchase(planId,days,price){
    const sym=CURRENCY_SYMBOLS[D.default_currency]||'‚ÇΩ';
    if(D.user.balance<price){
        closeModal();
        return toast(t('not_enough')+' '+D.user.balance+' '+sym,'error');
    }
    closeModal();
    showModal('<div style="text-align:center;padding:20px"><div class="spinner"></div><p style="margin-top:12px;color:var(--text2)">'+t('processing')+'</p></div>');
    try{
        const r=await fetch(API+'/api/purchase',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({plan_id:planId,duration_days:days})});
        closeModal();
        if(r.ok){
            toast(t('sub_done')+' ‚úÖ');
            const dr=await fetch(API+'/api/user/data');if(dr.ok){D=await dr.json();render()}
        } else {
            try{const j=await r.json();toast(j.detail||t('purchase_error'),'error')}
            catch(e2){toast(t('purchase_error')+' ('+r.status+')','error')}
        }
    }catch(e){closeModal();toast(e.message||t('net_error'),'error')}
}
async function startTrial(){
    showModal('<div style="text-align:center;padding:20px"><div class="spinner"></div><p style="margin-top:12px;color:var(--text2)">'+t('trial_activating')+'</p></div>');
    try{
        const r=await fetch(API+'/api/trial/activate',{method:'POST'});
        closeModal();
        if(r.ok){
            toast(t('trial_done')+' ‚úÖ','success');
            showModal('<div style="text-align:center;padding:30px"><div style="font-size:3rem">‚úÖ</div><h3 style="margin-top:12px;color:var(--green)">'+t('trial_done')+'</h3><p style="color:var(--text2);font-size:.84rem;margin-top:8px">'+t('trial_go_connect')+'</p><div class="modal-actions"><button class="btn btn-primary" onclick="closeModal();go(\'connect\')">'+t('setup')+'</button><button class="btn btn-secondary" onclick="closeModal()">'+t('close')+'</button></div></div>');
            const dr=await fetch(API+'/api/user/data');if(dr.ok){D=await dr.json();render()}
        } else {
            const j=await r.json();toast(j.detail||t('error'),'error');
        }
    }catch(e){closeModal();toast(t('net_error'),'error')}
}
function expandDevices(){
    if(D.subscription&&D.subscription.is_trial){
        showModal('<div style="text-align:center;padding:30px"><div style="font-size:3rem">‚ö†Ô∏è</div><h3 style="margin-top:12px;color:var(--gold)">'+t('expand_unavail')+'</h3><p style="color:var(--text2);font-size:.84rem;margin-top:8px">'+t('expand_trial_msg')+'</p><div class="modal-actions"><button class="btn btn-primary" onclick="closeModal();go(\'plans\')">'+t('buy_plan')+'</button><button class="btn btn-secondary" onclick="closeModal()">'+t('close')+'</button></div></div>');
        return;
    }
    toast(t('expand_via_bot'));
}
async function closeTicket(resolved){
    if(!curTicketId)return;
    try{
        const r=await fetch(API+'/api/tickets/'+curTicketId+'/close',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({resolved})});
        if(r.ok){
            toast(resolved?t('ticket_closed_resolved'):t('ticket_closed_unresolved'));
            $('ticket-reply').style.display='none';
            $('ticket-close-actions').style.display='none';
        }else{const j=await r.json();toast(j.detail||'–û—à–∏–±–∫–∞','error')}
    }catch(e){toast('–û—à–∏–±–∫–∞','error')}
}
function copyUrl(){
    const s=D.subscription;
    if(s&&s.url)navigator.clipboard.writeText(s.url).then(()=>toast(t('copied'))).catch(()=>toast(t('error'),'error'));
    else toast(t('no_sub_err'),'error');
}
function copyRef(){
    navigator.clipboard.writeText($('ref-link').textContent).then(()=>toast(t('link_copied'))).catch(()=>toast(t('error'),'error'));
}
async function activatePromo(){
    const code=$('promo-input').value.trim();if(!code)return;
    const r=$('promo-result');
    try{
        const res=await fetch(API+'/api/promocode/activate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({code})});
        const d=await res.json();r.style.display='block';
        if(res.ok){r.style.color='var(--green)';r.textContent=d.message||t('promo_activated')}
        else{r.style.color='var(--red)';r.textContent=d.detail||'–û—à–∏–±–∫–∞'}
    }catch(e){r.style.display='block';r.style.color='var(--red)';r.textContent='–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'}
}
async function logout(){await fetch(API+'/api/auth/logout',{method:'POST'});window.location.href='/web/login'}

/* ‚îÄ‚îÄ ADMIN ‚îÄ‚îÄ */
function admTab(t){
    curAdmTab=t;
    document.querySelectorAll('#adm-tabs .admin-tab').forEach((b,i)=>b.classList.toggle('active',['stats','users','plans','settings','tickets','brand'][i]===t));
    document.querySelectorAll('.admin-content').forEach(c=>c.classList.remove('active'));
    const el=$('adm-'+t);if(el)el.classList.add('active');
    loadAdm(t);
}
async function loadAdm(t){
    if(t==='stats')await loadStats();if(t==='users')await loadUsers();
    if(t==='plans')await loadAdmPlans();if(t==='settings')await loadSettings();
    if(t==='tickets')await loadAdmTickets();
    if(t==='brand')loadBrandForm();
}
async function loadStats(){
    try{const r=await fetch(API+'/api/admin/stats');if(!r.ok)return;const d=await r.json();
    $('st-total').textContent=d.total_users||0;$('st-active').textContent=d.active_subscriptions||0;
    $('st-expired').textContent=d.expired_subscriptions||0;$('st-revenue').textContent=d.total_revenue||0}catch(e){}
}
async function loadUsers(){
    try{const r=await fetch(API+'/api/admin/users');if(!r.ok)return;usersCache=await r.json();drawUsers(usersCache)}catch(e){}
}
function filterUsers(){
    const q=$('user-search').value.toLowerCase().trim();
    if(!q)return drawUsers(usersCache);
    drawUsers(usersCache.filter(u=>(u.name||'').toLowerCase().includes(q)||String(u.telegram_id).includes(q)||(u.username||'').toLowerCase().includes(q)));
}
function drawUsers(list){
    const el=$('users-list');
    if(!list.length){el.innerHTML='<div class="empty-state">–ü—É—Å—Ç–æ</div>';return}
    el.innerHTML=list.slice(0,50).map(u=>{
        const ini=(u.name||'?')[0].toUpperCase();
        const rc=u.role==='DEV'?'role-dev':u.role==='ADMIN'?'role-admin':'role-user';
        const rn=u.role==='DEV'?'DEV':u.role==='ADMIN'?'ADM':'USER';
        return '<div class="user-item" onclick="openUser('+u.telegram_id+')"><div class="user-item-info"><div class="user-avatar">'+esc(ini)+'</div><div><div class="user-name">'+esc(u.name||'‚Äî')+'</div><div class="user-sub">ID: '+u.telegram_id+'</div></div></div><span class="role-badge '+rc+'">'+rn+'</span></div>';
    }).join('');
}
async function openUser(tid){
    go('auser');$('aud-title').textContent='–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶';
    $('aud-body').innerHTML='<div style="text-align:center;padding:40px"><div class="spinner"></div></div>';
    try{
        const r=await fetch(API+'/api/admin/users/'+tid);if(!r.ok){$('aud-body').innerHTML='<div class="empty-state">–û—à–∏–±–∫–∞</div>';return}
        const u=await r.json();$('aud-title').textContent=u.name||'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';drawUserDetail(u);
    }catch(e){$('aud-body').innerHTML='<div class="empty-state">'+e.message+'</div>'}
}
function drawUserDetail(u){
    const rm={USER:'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',ADMIN:'–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',DEV:'–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫'};
    const si=u.subscription?'<div class="card-row"><span class="card-label">–ü–æ–¥–ø–∏—Å–∫–∞</span><span class="card-value">'+(u.subscription.plan_name||'‚Äî')+'</span></div><div class="card-row"><span class="card-label">–°—Ç–∞—Ç—É—Å</span><span class="card-value">'+u.subscription.status+'</span></div><div class="card-row"><span class="card-label">–ò—Å—Ç–µ–∫–∞–µ—Ç</span><span class="card-value">'+(u.subscription.expire_at||'‚Äî')+'</span></div>':'<div class="card-row"><span class="card-label">–ü–æ–¥–ø–∏—Å–∫–∞</span><span class="card-value" style="color:var(--text3)">–ù–µ—Ç</span></div>';
    $('aud-body').innerHTML='<div class="card"><div class="card-row"><span class="card-label">–ò–º—è</span><span class="card-value">'+esc(u.name||'‚Äî')+'</span></div><div class="card-row"><span class="card-label">Username</span><span class="card-value">'+(u.username?'@'+esc(u.username):'‚Äî')+'</span></div><div class="card-row"><span class="card-label">ID</span><span class="card-value">'+u.telegram_id+'</span></div><div class="card-row"><span class="card-label">–ë–∞–ª–∞–Ω—Å</span><span class="card-value">'+u.balance+' ‚ÇΩ</span></div><div class="card-row"><span class="card-label">–†–æ–ª—å</span><span class="card-value">'+(rm[u.role]||u.role)+'</span></div><div class="card-row"><span class="card-label">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span><span class="card-value">'+(u.is_blocked?'–î–∞':'–ù–µ—Ç')+'</span></div>'+si+'</div><div style="display:flex;flex-direction:column;gap:8px"><button class="btn btn-secondary btn-full" onclick="changeRole('+u.telegram_id+',\''+u.role+'\')">–ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å</button><button class="btn btn-secondary btn-full" onclick="changeBal('+u.telegram_id+','+u.balance+')">–ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button><button class="btn '+(u.is_blocked?'btn-primary':'btn-danger')+' btn-full" onclick="toggleBlock('+u.telegram_id+','+u.is_blocked+')">'+(u.is_blocked?'–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å':'–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å')+'</button></div>';
}
function changeRole(tid,cur){
    const roles=['USER','ADMIN','DEV'],names=['–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å','–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä','–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫'];
    showModal('<h3>–ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å</h3>'+roles.map((r,i)=>'<button class="btn '+(r===cur?'btn-primary':'btn-secondary')+' btn-full" style="margin-top:6px" onclick="setRole('+tid+',\''+r+'\')">'+names[i]+'</button>').join('')+'<div class="modal-actions"><button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button></div>');
}
async function setRole(tid,role){closeModal();try{const r=await fetch(API+'/api/admin/users/'+tid+'/role',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({role})});if(r.ok){toast('–†–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∞');openUser(tid)}else{const d=await r.json();toast(d.detail||'–û—à–∏–±–∫–∞','error')}}catch(e){toast('–û—à–∏–±–∫–∞','error')}}
let balType='basic';
function changeBal(tid,cur){
    balType='basic';
    showModal('<h3>–ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</h3><p style="color:var(--text2);font-size:.84rem;margin-bottom:10px">–¢–µ–∫—É—â–∏–π: '+cur+' ‚ÇΩ</p>'+
        '<div class="form-group"><label>–¢–∏–ø –±–∞–ª–∞–Ω—Å–∞</label><div style="display:flex;gap:6px;margin-top:4px"><button class="btn btn-primary btn-sm" id="bal-type-basic" onclick="switchBalType(\'basic\')">–û—Å–Ω–æ–≤–Ω–æ–π</button><button class="btn btn-secondary btn-sm" id="bal-type-bonus" onclick="switchBalType(\'bonus\')">–ë–æ–Ω—É—Å–Ω—ã–π</button></div></div>'+
        '<div class="form-group"><label>–°—É–º–º–∞ (+/-)</label><input class="form-input" id="bal-amt" type="number" placeholder="100"></div><div class="modal-actions"><button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button><button class="btn btn-primary" onclick="setBal('+tid+')">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button></div>');
}
function switchBalType(t){
    balType=t;
    const bb=$('bal-type-basic'),bn=$('bal-type-bonus');
    if(t==='basic'){bb.className='btn btn-primary btn-sm';bn.className='btn btn-secondary btn-sm'}
    else{bb.className='btn btn-secondary btn-sm';bn.className='btn btn-primary btn-sm'}
}
async function setBal(tid){const a=parseFloat($('bal-amt').value);if(isNaN(a))return toast('–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ','error');closeModal();
    const endpoint=balType==='bonus'?'/bonus-balance':'/balance';
    try{const r=await fetch(API+'/api/admin/users/'+tid+endpoint,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({amount:a})});if(r.ok){toast((balType==='bonus'?'–ë–æ–Ω—É—Å–Ω—ã–π –±':'–ë')+'–∞–ª–∞–Ω—Å –∏–∑–º–µ–Ω—ë–Ω');openUser(tid)}else{const d=await r.json();toast(d.detail||'–û—à–∏–±–∫–∞','error')}}catch(e){toast('–û—à–∏–±–∫–∞','error')}}
async function toggleBlock(tid,blocked){try{const r=await fetch(API+'/api/admin/users/'+tid+'/block',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({block:!blocked})});if(r.ok){toast(blocked?'–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω':'–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');openUser(tid)}else{const d=await r.json();toast(d.detail||'–û—à–∏–±–∫–∞','error')}}catch(e){toast('–û—à–∏–±–∫–∞','error')}}

/* ‚îÄ‚îÄ Admin Plans (enhanced) ‚îÄ‚îÄ */
let admPlansCache=[];
async function loadAdmPlans(){
    try{const r=await fetch(API+'/api/admin/plans');if(!r.ok)return;admPlansCache=await r.json();
    $('adm-plans-count').textContent='–¢–∞—Ä–∏—Ñ—ã ('+admPlansCache.length+')';
    drawAdmPlans()}catch(e){}
}
function drawAdmPlans(){
    const el=$('adm-plans-list');
    if(!admPlansCache.length){el.innerHTML='<div class="empty-state">–ù–µ—Ç —Ç–∞—Ä–∏—Ñ–æ–≤</div>';return}
    el.innerHTML=admPlansCache.map(p=>{
        const avl=AVAIL_LABELS[p.availability]||p.availability;
        const isTrial=p.availability==='TRIAL';
        return '<div class="plan-admin-card'+(p.is_active?'':' inactive')+'" onclick="editPlan('+p.id+')">'+
            '<div class="plan-admin-top">'+
                '<span class="plan-admin-name">'+esc(p.name)+'</span>'+
                (p.tag?'<span class="plan-admin-tag">'+esc(p.tag)+'</span>':'')+
                '<span class="avail-badge'+(isTrial?' trial':'')+'">'+avl+'</span>'+
                '<div class="plan-admin-actions" onclick="event.stopPropagation()">'+
                    '<button class="btn-toggle-plan'+(p.is_active?' active':'')+'" onclick="togglePlan('+p.id+',this)" title="'+(p.is_active?'–í—ã–∫–ª—é—á–∏—Ç—å':'–í–∫–ª—é—á–∏—Ç—å')+'"></button>'+
                    '<button class="btn-trash" onclick="delPlan('+p.id+')" title="–£–¥–∞–ª–∏—Ç—å">üóë</button>'+
                '</div>'+
            '</div>'+
            '<div class="plan-admin-meta">'+
                '<span>üì¶ '+(p.traffic_limit||'‚àû')+' GB</span>'+
                '<span>üì± '+(p.device_limit||'‚àû')+' —É—Å—Ç—Ä.</span>'+
                '<span>‚è± '+(p.durations||[]).length+' –ø–µ—Ä–∏–æ–¥(–æ–≤)</span>'+
            '</div>'+
        '</div>';
    }).join('');
}
async function togglePlan(id,btn){
    try{const r=await fetch(API+'/api/admin/plans/'+id+'/toggle',{method:'PATCH'});
    if(r.ok){const d=await r.json();btn.classList.toggle('active',d.is_active);
    const p=admPlansCache.find(x=>x.id===id);if(p)p.is_active=d.is_active;
    btn.closest('.plan-admin-card').classList.toggle('inactive',!d.is_active);
    toast(d.is_active?'–í–∫–ª—é—á—ë–Ω':'–í—ã–∫–ª—é—á–µ–Ω')}else toast('–û—à–∏–±–∫–∞','error')}catch(e){toast('–û—à–∏–±–∫–∞','error')}
}
async function delPlan(id){if(!confirm('–£–¥–∞–ª–∏—Ç—å —Ç–∞—Ä–∏—Ñ?'))return;try{const r=await fetch(API+'/api/admin/plans/'+id,{method:'DELETE'});if(r.ok){toast('–£–¥–∞–ª—ë–Ω');loadAdmPlans()}else{const j=await r.json();toast(j.detail||'–û—à–∏–±–∫–∞','error')}}catch(e){toast('–û—à–∏–±–∫–∞','error')}}

/* ‚îÄ‚îÄ Plan Create / Edit Modal ‚îÄ‚îÄ */
let editingPlanId=null;
function showCreatePlan(){editingPlanId=null;showPlanModal({name:'',description:'',tag:'',availability:'ALL',type:'BOTH',traffic_limit:100,device_limit:1,durations:[{days:30,prices:[{currency:D.default_currency||'RUB',amount:'0'}]}]},'–°–æ–∑–¥–∞—Ç—å —Ç–∞—Ä–∏—Ñ')}
function editPlan(id){
    const p=admPlansCache.find(x=>x.id===id);if(!p)return;
    editingPlanId=id;
    showPlanModal(p,'–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞—Ä–∏—Ñ');
}
function showPlanModal(p,title){
    const dc=D.default_currency||'RUB';
    const durs=(p.durations||[]).map((d,i)=>{
        const pr=(d.prices||[]).find(x=>x.currency===dc);
        const amt=pr?pr.amount:'0';
        return durEntryHtml(i,d.days,amt);
    }).join('');
    const availOpts=Object.entries(AVAIL_LABELS).map(([k,v])=>'<option value="'+k+'"'+(p.availability===k?' selected':'')+'>'+v+'</option>').join('');
    const typeOpts=Object.entries(TYPE_LABELS).map(([k,v])=>'<option value="'+k+'"'+(p.type===k?' selected':'')+'>'+v+'</option>').join('');
    showModal(
        '<h3>'+title+'</h3>'+
        '<div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input class="form-input" id="np-name" value="'+esc(p.name)+'" placeholder="–ë–∞–∑–æ–≤—ã–π"></div>'+
        '<div class="form-group"><label>–û–ø–∏—Å–∞–Ω–∏–µ</label><input class="form-input" id="np-desc" value="'+esc(p.description||'')+'" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞"></div>'+
        '<div class="form-row"><div class="form-group"><label>–¢–µ–≥</label><input class="form-input" id="np-tag" value="'+esc(p.tag||'')+'" placeholder="base"></div><div class="form-group"><label>–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</label><select class="form-input" id="np-avail">'+availOpts+'</select></div></div>'+
        '<div class="form-row"><div class="form-group"><label>–¢–∏–ø</label><select class="form-input" id="np-type" onchange="onPlanTypeChange()">'+typeOpts+'</select></div><div class="form-group"><label>–¢—Ä–∞—Ñ–∏–∫ (GB)</label><input class="form-input" id="np-traffic" type="number" value="'+p.traffic_limit+'"></div></div>'+
        '<div class="form-group"><label>–£—Å—Ç—Ä–æ–π—Å—Ç–≤</label><input class="form-input" id="np-dev" type="number" value="'+p.device_limit+'"></div>'+
        '<div style="margin-bottom:8px"><label style="font-size:.8rem;color:var(--text3);font-weight:500">–ü–µ—Ä–∏–æ–¥—ã –∏ —Ü–µ–Ω—ã ('+(CURRENCY_SYMBOLS[dc]||dc)+')</label></div>'+
        '<div id="dur-list">'+durs+'</div>'+
        '<button class="btn btn-secondary btn-sm" onclick="addDurEntry()" style="margin-bottom:10px">+ –ü–µ—Ä–∏–æ–¥</button>'+
        '<div class="modal-actions"><button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button><button class="btn btn-primary" onclick="savePlan()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></div>'
    );
    setTimeout(()=>onPlanTypeChange(),0);
}
function onPlanTypeChange(){
    const t=$('np-type');if(!t)return;
    const v=t.value;
    const trEl=$('np-traffic'), devEl=$('np-dev');
    if(!trEl||!devEl)return;
    if(v==='TRAFFIC'){trEl.disabled=false;devEl.disabled=true;devEl.value='0'}
    else if(v==='DEVICES'){trEl.disabled=true;trEl.value='0';devEl.disabled=false}
    else if(v==='UNLIMITED'){trEl.disabled=true;trEl.value='0';devEl.disabled=true;devEl.value='0'}
    else{trEl.disabled=false;devEl.disabled=false}
}
function durEntryHtml(i,days,amount){
    return '<div class="duration-entry" data-idx="'+i+'"><div class="duration-entry-header"><span style="font-size:.8rem;color:var(--text2);font-weight:600">–ü–µ—Ä–∏–æ–¥ #'+(i+1)+'</span><button class="dur-remove" onclick="this.closest(\'.duration-entry\').remove()">‚úï</button></div><div class="form-row"><div class="form-group"><label>–î–Ω–µ–π</label><input class="form-input dur-days" type="number" value="'+days+'" min="1"></div><div class="form-group"><label>–¶–µ–Ω–∞</label><input class="form-input dur-price" type="number" value="'+amount+'" min="0" step="0.01"></div></div></div>';
}
function addDurEntry(){
    const list=$('dur-list');
    const idx=list.querySelectorAll('.duration-entry').length;
    list.insertAdjacentHTML('beforeend',durEntryHtml(idx,30,'0'));
}
async function savePlan(){
    const name=$('np-name').value.trim();if(!name)return toast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ','error');
    const dc=D.default_currency||'RUB';
    const durations=[];
    $('dur-list').querySelectorAll('.duration-entry').forEach(el=>{
        const days=parseInt(el.querySelector('.dur-days').value)||30;
        const price=el.querySelector('.dur-price').value||'0';
        durations.push({days,prices:[{currency:dc,amount:price}]});
    });
    const body={
        name,
        description:$('np-desc').value.trim(),
        tag:$('np-tag').value.trim(),
        availability:$('np-avail').value,
        type:$('np-type').value,
        traffic_limit:parseInt($('np-traffic').value)||100,
        device_limit:parseInt($('np-dev').value)||1,
        durations
    };
    closeModal();
    try{
        const url=editingPlanId?API+'/api/admin/plans/'+editingPlanId:API+'/api/admin/plans';
        const method=editingPlanId?'PUT':'POST';
        const r=await fetch(url,{method,headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
        if(r.ok){toast(editingPlanId?'–¢–∞—Ä–∏—Ñ –æ–±–Ω–æ–≤–ª—ë–Ω':'–¢–∞—Ä–∏—Ñ —Å–æ–∑–¥–∞–Ω');loadAdmPlans()}
        else{const j=await r.json();toast(j.detail||'–û—à–∏–±–∫–∞','error')}
    }catch(e){toast('–û—à–∏–±–∫–∞','error')}
}

/* Settings */
let settingsCache={};
async function loadSettings(){
    try{const r=await fetch(API+'/api/admin/settings');if(!r.ok)return;settingsCache=await r.json();drawSettings()}catch(e){}
}
function drawSettings(){
    const s=settingsCache;
    const sections=[
        {title:'–§—É–Ω–∫—Ü–∏–∏',items:[
            {key:'balance_enabled',icon:'üí∞',label:'–ë–∞–ª–∞–Ω—Å',desc:'–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞',detail:'balance'},
            {key:'community_enabled',icon:'üí¨',label:'–°–æ–æ–±—â–µ—Å—Ç–≤–æ',desc:'–°—Å—ã–ª–∫–∞ –Ω–∞ Telegram-–≥—Ä—É–ø–ø—É',detail:'community'},
            {key:'tos_enabled',icon:'üìú',label:'–û—Ñ–µ—Ä—Ç–∞',desc:'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ'},
            {key:'referral_enabled',icon:'ü§ù',label:'–†–µ—Ñ–µ—Ä–∞–ª—ã',desc:'–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞',detail:'referral'},
            {key:'promocodes_enabled',icon:'üéÅ',label:'–ü—Ä–æ–º–æ–∫–æ–¥—ã',desc:'–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤'},
            {key:'notifications_enabled',icon:'üîî',label:'–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è',desc:'–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º',detail:'notifications'},
            {key:'extra_devices_enabled',icon:'üì±',label:'–î–æ–ø. —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞',desc:'–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤',detail:'extra_devices'},
            {key:'transfers_enabled',icon:'üí∏',label:'–ü–µ—Ä–µ–≤–æ–¥—ã',desc:'–ü–µ—Ä–µ–≤–æ–¥—ã –±–∞–ª–∞–Ω—Å–∞ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏',detail:'transfers'},
            {key:'global_discount_enabled',icon:'üè∑',label:'–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å–∫–∏–¥–∫–∞',desc:'–°–∫–∏–¥–∫–∞ –Ω–∞ –≤—Å–µ —Ç–∞—Ä–∏—Ñ—ã',detail:'global_discount'},
        ]},
        {title:'–î–æ—Å—Ç—É–ø',items:[
            {key:'access_enabled',icon:'üîê',label:'–î–æ—Å—Ç—É–ø',desc:'–ì–ª–æ–±–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É'},
            {key:'purchases_allowed',icon:'üõí',label:'–ü–æ–∫—É–ø–∫–∏',desc:'–†–∞–∑—Ä–µ—à–∏—Ç—å –ø–æ–∫—É–ø–∫—É –ø–æ–¥–ø–∏—Å–æ–∫'},
            {key:'registration_allowed',icon:'üìù',label:'–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è',desc:'–†–∞–∑—Ä–µ—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'},
        ]},
        {title:'–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º',items:[
            {key:'language_enabled',icon:'üåê',label:'–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å',desc:'–í—ã–±–æ—Ä —è–∑—ã–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –±–æ—Ç–∞'},
            {key:'access_mode',icon:'üîë',label:'–†–µ–∂–∏–º –¥–æ—Å—Ç—É–ø–∞',desc:s.access_mode||'PUBLIC',type:'select',options:['PUBLIC','PRIVATE','WHITELIST']},
            {key:'default_currency',icon:'üí±',label:'–í–∞–ª—é—Ç–∞',desc:s.default_currency||'RUB',type:'select',options:['RUB','USD','EUR','XTR'],detail:'currency_rates'},
            {key:'bot_locale',icon:'üó£',label:'–Ø–∑—ã–∫ –±–æ—Ç–∞',desc:s.bot_locale||'RU',type:'select',options:['RU','EN','UK','DE']},
        ]}
    ];
    let html='';
    sections.forEach(sec=>{
        html+='<div style="font-size:.76rem;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin:14px 0 8px;padding:0 4px">'+sec.title+'</div><div class="card" style="padding:0;overflow:hidden">';
        sec.items.forEach(item=>{
            const val=s[item.key];
            if(item.type==='select'){
                html+='<div class="settings-row" onclick="openSettingDetail(\''+item.key+'\',\''+item.label+'\',\''+(item.detail||'')+'\')"><div class="settings-row-left"><span class="settings-icon">'+item.icon+'</span><div><div class="settings-label">'+item.label+'</div><div class="settings-desc">'+item.desc+'</div></div></div><span class="settings-chevron">'+esc(String(val))+' ‚Ä∫</span></div>';
            } else if(typeof val==='boolean'){
                html+='<div class="settings-row" onclick="openSettingDetail(\''+item.key+'\',\''+item.label+'\',\''+(item.detail||'')+'\')"><div class="settings-row-left"><span class="settings-icon">'+item.icon+'</span><div><div class="settings-label">'+item.label+'</div><div class="settings-desc">'+item.desc+'</div></div></div><button class="toggle-switch '+(val?'active':'')+'" onclick="event.stopPropagation();toggleSet(\''+item.key+'\','+(!val)+',this)"></button></div>';
            } else {
                html+='<div class="settings-row" onclick="openSettingDetail(\''+item.key+'\',\''+item.label+'\',\''+(item.detail||'')+'\')"><div class="settings-row-left"><span class="settings-icon">'+item.icon+'</span><div><div class="settings-label">'+item.label+'</div><div class="settings-desc">'+esc(String(val))+'</div></div></div><span class="settings-chevron">‚Ä∫</span></div>';
            }
        });
        html+='</div>';
    });
    $('settings-list').innerHTML=html;
}
function openSettingDetail(key,label,detail){
    const s=settingsCache, val=s[key];
    let body='';

    if(detail==='balance'){
        const modes={SEPARATE:'–†–∞–∑–¥–µ–ª—å–Ω–æ',COMBINED:'–û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π'};
        body+='<div class="form-group"><label>–†–µ–∂–∏–º –±–∞–ª–∞–Ω—Å–∞</label><div style="display:flex;gap:6px;margin-top:4px">'+
            Object.entries(modes).map(([k,v])=>'<button class="btn '+((s.balance_mode||'SEPARATE')===k?'btn-primary':'btn-secondary')+' btn-sm" onclick="saveSubSetting(\'balance_mode\',\''+k+'\')">'+v+'</button>').join('')+'</div></div>'+
            '<div class="form-group"><label>–ú–∏–Ω–∏–º—É–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</label><input class="form-input" id="sd-bal-min" type="number" value="'+(s.balance_min_amount||10)+'"></div>'+
            '<div class="form-group"><label>–ú–∞–∫—Å–∏–º—É–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</label><input class="form-input" id="sd-bal-max" type="number" value="'+(s.balance_max_amount||100000)+'"></div>'+
            '<button class="btn btn-primary btn-sm btn-full" onclick="saveMultiSub({balance_min_amount:parseInt($(\'sd-bal-min\').value),balance_max_amount:parseInt($(\'sd-bal-max\').value)})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>';
    } else if(detail==='community'){
        body+='<div class="form-group"><label>URL —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</label><input class="form-input" id="sd-comm-url" value="'+esc(s.community_url||'')+'" placeholder="https://t.me/..."></div>'+
            '<button class="btn btn-primary btn-sm btn-full" onclick="saveMultiSub({community_url:$(\'sd-comm-url\').value})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>';
    } else if(detail==='referral'){
        body+='<div class="form-group"><label>–£—Ä–æ–≤–µ–Ω—å</label><div style="display:flex;gap:6px;margin-top:4px">'+
            ['FIRST','SECOND','THIRD'].map(l=>'<button class="btn '+((s.referral_level||'FIRST')===l?'btn-primary':'btn-secondary')+' btn-sm" onclick="saveSubSetting(\'referral_level\',\''+l+'\')">'+l+'</button>').join('')+'</div></div>'+
            '<div class="form-group"><label>–°—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è</label><div style="display:flex;gap:6px;margin-top:4px">'+
            ['ON_EACH_PAYMENT','ON_FIRST_PAYMENT'].map(v=>'<button class="btn btn-sm '+((s.referral_accrual_strategy||'ON_EACH_PAYMENT')===v?'btn-primary':'btn-secondary')+'" style="font-size:.7rem" onclick="saveSubSetting(\'referral_accrual_strategy\',\''+v+'\')">'+v.replace(/_/g,' ')+'</button>').join('')+'</div></div>';
    } else if(detail==='notifications'){
        body+='<div class="form-group"><label>–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</label></div>'+
            '<div class="toggle-row" style="margin-bottom:8px"><label>–£–≤–µ–¥–æ–º–ª—è—Ç—å</label><button class="toggle-switch '+(s.inactive_notif_enabled?'active':'')+'" onclick="saveSubSetting(\'inactive_notif_enabled\','+(!s.inactive_notif_enabled)+');this.classList.toggle(\'active\')"></button></div>'+
            '<div class="form-group"><label>–ü–æ—Ä–æ–≥ (—á–∞—Å–æ–≤)</label><input class="form-input" id="sd-inact-hrs" type="number" value="'+(s.inactive_notif_hours||24)+'"></div>'+
            '<button class="btn btn-primary btn-sm btn-full" onclick="saveMultiSub({inactive_notif_hours:parseInt($(\'sd-inact-hrs\').value)})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>';
    } else if(detail==='extra_devices'){
        body+='<div class="form-group"><label>–¶–µ–Ω–∞ –∑–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</label><input class="form-input" id="sd-ed-price" type="number" value="'+(s.extra_devices_price||100)+'"></div>'+
            '<div class="toggle-row" style="margin-bottom:8px"><label>–ï–¥–∏–Ω–æ—Ä–∞–∑–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞</label><button class="toggle-switch '+(s.extra_devices_one_time?'active':'')+'" onclick="saveSubSetting(\'extra_devices_one_time\','+(!s.extra_devices_one_time)+');this.classList.toggle(\'active\')"></button></div>'+
            '<div class="form-group"><label>–ú–∏–Ω. –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è</label><input class="form-input" id="sd-ed-days" type="number" value="'+(s.extra_devices_min_days||10)+'"></div>'+
            '<button class="btn btn-primary btn-sm btn-full" onclick="saveMultiSub({extra_devices_price:parseInt($(\'sd-ed-price\').value),extra_devices_min_days:parseInt($(\'sd-ed-days\').value)})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>';
    } else if(detail==='transfers'){
        body+='<div class="form-group"><label>–¢–∏–ø –∫–æ–º–∏—Å—Å–∏–∏</label><div style="display:flex;gap:6px;margin-top:4px">'+
            ['percent','fixed'].map(t=>'<button class="btn '+((s.transfers_commission_type||'percent')===t?'btn-primary':'btn-secondary')+' btn-sm" onclick="saveSubSetting(\'transfers_commission_type\',\''+t+'\')">'+({percent:'–ü—Ä–æ—Ü–µ–Ω—Ç',fixed:'–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è'}[t])+'</button>').join('')+'</div></div>'+
            '<div class="form-group"><label>–ö–æ–º–∏—Å—Å–∏—è ('+(s.transfers_commission_type==='fixed'?'‚ÇΩ':'%')+')</label><input class="form-input" id="sd-tr-comm" type="number" value="'+(s.transfers_commission_value||5)+'"></div>'+
            '<div class="form-group"><label>–ú–∏–Ω. —Å—É–º–º–∞</label><input class="form-input" id="sd-tr-min" type="number" value="'+(s.transfers_min_amount||10)+'"></div>'+
            '<div class="form-group"><label>–ú–∞–∫—Å. —Å—É–º–º–∞</label><input class="form-input" id="sd-tr-max" type="number" value="'+(s.transfers_max_amount||100000)+'"></div>'+
            '<button class="btn btn-primary btn-sm btn-full" onclick="saveMultiSub({transfers_commission_value:parseInt($(\'sd-tr-comm\').value),transfers_min_amount:parseInt($(\'sd-tr-min\').value),transfers_max_amount:parseInt($(\'sd-tr-max\').value)})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>';
    } else if(detail==='global_discount'){
        body+='<div class="form-group"><label>–¢–∏–ø —Å–∫–∏–¥–∫–∏</label><div style="display:flex;gap:6px;margin-top:4px">'+
            ['percent','fixed'].map(t=>'<button class="btn '+((s.global_discount_type||'percent')===t?'btn-primary':'btn-secondary')+' btn-sm" onclick="saveSubSetting(\'global_discount_type\',\''+t+'\')">'+({percent:'–ü—Ä–æ—Ü–µ–Ω—Ç',fixed:'–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è'}[t])+'</button>').join('')+'</div></div>'+
            '<div class="form-group"><label>–ó–Ω–∞—á–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏</label><input class="form-input" id="sd-gd-val" type="number" value="'+(s.global_discount_value||0)+'"></div>'+
            '<div class="toggle-row" style="margin-bottom:8px"><label>–°–∫–ª–∞–¥—ã–≤–∞—Ç—å —Å–∫–∏–¥–∫–∏</label><button class="toggle-switch '+(s.global_discount_stack?'active':'')+'" onclick="saveSubSetting(\'global_discount_stack\','+(!s.global_discount_stack)+');this.classList.toggle(\'active\')"></button></div>'+
            '<button class="btn btn-primary btn-sm btn-full" onclick="saveMultiSub({global_discount_value:parseInt($(\'sd-gd-val\').value)})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>';
    } else if(detail==='currency_rates'){
        const opts=['RUB','USD','EUR','XTR'];
        body+=opts.map(o=>'<button class="btn '+(String(val)===o?'btn-primary':'btn-secondary')+' btn-full" style="margin-top:6px" onclick="saveSettingVal(\''+key+'\',\''+o+'\')">'+o+'</button>').join('');
        body+='<div style="margin-top:16px;border-top:1px solid var(--border);padding-top:12px"><div style="font-size:.76rem;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px">–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç</div></div>'+
            '<div class="toggle-row" style="margin-bottom:8px"><label>–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–¶–ë –†–§)</label><button class="toggle-switch '+(s.currency_rates_auto?'active':'')+'" onclick="saveSubSetting(\'currency_rates_auto\','+(!s.currency_rates_auto)+');this.classList.toggle(\'active\')"></button></div>'+
            '<div class="form-group"><label>USD ‚Üí RUB</label><input class="form-input" id="sd-cr-usd" type="number" step="0.01" value="'+(s.currency_rates_usd||90)+'"></div>'+
            '<div class="form-group"><label>EUR ‚Üí RUB</label><input class="form-input" id="sd-cr-eur" type="number" step="0.01" value="'+(s.currency_rates_eur||100)+'"></div>'+
            '<div class="form-group"><label>Stars ‚Üí RUB</label><input class="form-input" id="sd-cr-stars" type="number" step="0.01" value="'+(s.currency_rates_stars||1.5)+'"></div>'+
            '<button class="btn btn-primary btn-sm btn-full" onclick="saveMultiSub({currency_rates_usd:parseFloat($(\'sd-cr-usd\').value),currency_rates_eur:parseFloat($(\'sd-cr-eur\').value),currency_rates_stars:parseFloat($(\'sd-cr-stars\').value)})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫—É—Ä—Å—ã</button>';
    } else if(typeof val==='boolean'){
        // Simple boolean without sub-settings
    } else {
        const opts=key==='access_mode'?['PUBLIC','PRIVATE','WHITELIST']:key==='default_currency'?['RUB','USD','EUR','XTR']:key==='bot_locale'?['RU','EN','UK','DE']:[];
        if(opts.length){
            body+=opts.map(o=>'<button class="btn '+(String(val)===o?'btn-primary':'btn-secondary')+' btn-full" style="margin-top:6px" onclick="saveSettingVal(\''+key+'\',\''+o+'\')">'+o+'</button>').join('');
        } else {
            body+='<div class="form-group"><label>–ó–Ω–∞—á–µ–Ω–∏–µ</label><input class="form-input" id="set-val" value="'+esc(String(val))+'"></div><button class="btn btn-primary btn-sm" onclick="saveSettingStr(\''+key+'\',$(\'set-val\').value)">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>';
        }
    }
    if(!body)return;
    showModal('<h3>'+label+'</h3>'+body+'<div class="modal-actions"><button class="btn btn-secondary" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button></div>');
}
async function saveSubSetting(k,v){
    try{const r=await fetch(API+'/api/admin/settings',{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify({[k]:v})});
    if(r.ok){settingsCache[k]=v;toast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ')}else toast('–û—à–∏–±–∫–∞','error')}catch(e){toast('–û—à–∏–±–∫–∞','error')}
}
async function saveMultiSub(obj){
    try{const r=await fetch(API+'/api/admin/settings',{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify(obj)});
    if(r.ok){Object.assign(settingsCache,obj);closeModal();drawSettings();toast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ')}else toast('–û—à–∏–±–∫–∞','error')}catch(e){toast('–û—à–∏–±–∫–∞','error')}
}
async function toggleSetAndRefresh(k,v,btn){
    try{const r=await fetch(API+'/api/admin/settings',{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify({[k]:v})});
    if(r.ok){settingsCache[k]=v;btn.classList.toggle('active',v);drawSettings();toast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ')}else toast('–û—à–∏–±–∫–∞','error')}catch(e){toast('–û—à–∏–±–∫–∞','error')}
}
async function toggleSet(k,v,btn){
    try{const r=await fetch(API+'/api/admin/settings',{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify({[k]:v})});
    if(r.ok){settingsCache[k]=v;btn.classList.toggle('active',v);drawSettings();toast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ')}else toast('–û—à–∏–±–∫–∞','error')}catch(e){toast('–û—à–∏–±–∫–∞','error')}
}
async function saveSettingStr(k,v){
    try{const r=await fetch(API+'/api/admin/settings',{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify({[k]:v})});
    if(r.ok){settingsCache[k]=v;closeModal();drawSettings();toast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ')}else toast('–û—à–∏–±–∫–∞','error')}catch(e){toast('–û—à–∏–±–∫–∞','error')}
}
async function saveSettingVal(k,v){
    try{const r=await fetch(API+'/api/admin/settings',{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify({[k]:v})});
    if(r.ok){settingsCache[k]=v;closeModal();drawSettings();toast(t('saved'));
        if(k==='bot_locale'){CUR_LOCALE=v;render();applyLocale()}
    }else toast(t('error'),'error')}catch(e){toast(t('error'),'error')}
}

/* Brand */
function loadBrandForm(){$('br-name').value='';$('br-logo').value='';$('br-slogan').value='';
    fetch(API+'/api/settings/brand').then(r=>r.json()).then(d=>{$('br-name').value=d.name||'';$('br-logo').value=d.logo||'';$('br-slogan').value=d.slogan||''}).catch(()=>{})
}
async function saveBrand(){
    const d={name:$('br-name').value.trim()||'VPN Shop',logo:$('br-logo').value.trim()||'üîê',slogan:$('br-slogan').value.trim()};
    try{const r=await fetch(API+'/api/settings/brand',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(d)});if(r.ok)toast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');else toast('–û—à–∏–±–∫–∞','error')}catch(e){toast('–û—à–∏–±–∫–∞','error')}
}

/* ‚îÄ‚îÄ Tickets (User) ‚îÄ‚îÄ */
let curTicketId=null;
async function loadTickets(){
    try{const r=await fetch(API+'/api/tickets');if(!r.ok)return;const tks=await r.json();
    const el=$('tickets-list');
    if(!tks.length){el.innerHTML='<div class="empty-state"><span class="empty-icon">üé´</span><h3>'+t('no_tickets')+'</h3><p style="color:var(--text3);font-size:.84rem">'+t('create_first')+'</p></div>';return}
    el.innerHTML=tks.map(t=>{
        const st=t.status.toLowerCase();
        const last=t.messages&&t.messages.length?t.messages[t.messages.length-1].text:'';
        return '<div class="ticket-item'+(t.is_read_by_user?'':' unread')+'" onclick="openTicket('+t.id+')">'+
            '<div class="ticket-top"><span class="ticket-subject">'+esc(t.subject)+'</span><span class="ticket-status '+st+'">'+st+'</span></div>'+
            '<div class="ticket-preview">'+esc(last.substring(0,80))+'</div>'+
            '<div class="ticket-date">'+t.updated_at+'</div></div>';
    }).join('')}catch(e){}
}
async function openTicket(id){
    curTicketId=id;go('ticket');$('ticket-title').textContent='–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶';$('ticket-chat').innerHTML='';$('ticket-reply').style.display='none';
    try{const r=await fetch(API+'/api/tickets/'+id);if(!r.ok)return;
    const t=await r.json();$('ticket-title').textContent=t.subject;
    renderTicketChat($('ticket-chat'),t.messages);
    const hasAdminReply=(t.messages||[]).some(m=>m.is_admin);
    if(t.status!=='CLOSED'){
        $('ticket-reply').style.display='flex';
        $('ticket-close-actions').style.display=hasAdminReply?'flex':'none';
    } else {
        $('ticket-reply').style.display='none';
        $('ticket-close-actions').style.display='none';
    }
    }catch(e){}
}
function renderTicketChat(el,msgs){
    el.innerHTML=(msgs||[]).map(m=>{
        const cls=m.is_admin?'admin':'user';
        return '<div class="ticket-msg '+cls+'">'+esc(m.text)+'<div class="ticket-msg-time">'+m.created_at+'</div></div>';
    }).join('');el.scrollTop=el.scrollHeight;
}
async function sendTicketReply(){
    const text=$('ticket-text').value.trim();if(!text||!curTicketId)return;
    try{const r=await fetch(API+'/api/tickets/'+curTicketId+'/reply',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text})});
    if(r.ok){$('ticket-text').value='';const t=await r.json();renderTicketChat($('ticket-chat'),t.messages)}else toast('–û—à–∏–±–∫–∞','error')}catch(e){toast('–û—à–∏–±–∫–∞','error')}
}
function showNewTicket(){
    showModal('<h3>'+t('new_ticket_title')+'</h3><div class="form-group"><label>'+t('subject')+'</label><input class="form-input" id="nt-subj" placeholder="..."></div><div class="form-group"><label>'+t('message')+'</label><textarea class="form-input" id="nt-text" rows="4" placeholder="..." style="resize:vertical"></textarea></div><div class="modal-actions"><button class="btn btn-secondary" onclick="closeModal()">'+t('cancel')+'</button><button class="btn btn-primary" onclick="createTicket()">'+t('send')+'</button></div>');
}
async function createTicket(){
    const subject=$('nt-subj').value.trim(),text=$('nt-text').value.trim();
    if(!subject||!text)return toast(t('fill_all'),'error');closeModal();
    try{const r=await fetch(API+'/api/tickets',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({subject,text})});
    if(r.ok){toast(t('ticket_created'));const t2=await r.json();curTicketId=t2.id;openTicket(t2.id)}else{const j=await r.json();toast(j.detail||t('error'),'error')}}catch(e){toast(t('error'),'error')}
}

/* ‚îÄ‚îÄ Tickets (Admin) ‚îÄ‚îÄ */
let admTicketsCache=[];
async function loadAdmTickets(){
    try{const r=await fetch(API+'/api/admin/tickets');if(!r.ok)return;admTicketsCache=await r.json();
    const el=$('adm-tickets-list');
    if(!admTicketsCache.length){el.innerHTML='<div class="empty-state">–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤</div>';return}
    el.innerHTML=admTicketsCache.map(t=>{
        const st=t.status.toLowerCase();
        const last=t.messages&&t.messages.length?t.messages[t.messages.length-1].text:'';
        return '<div class="ticket-item'+(t.is_read_by_admin?'':' unread')+'" onclick="openAdmTicket('+t.id+')">'+
            '<div class="ticket-top"><span class="ticket-subject">'+esc(t.subject)+'</span><span class="ticket-status '+st+'">'+st+'</span></div>'+
            '<div class="ticket-preview"><b>ID '+t.user_telegram_id+'</b> ‚Äî '+esc(last.substring(0,60))+'</div>'+
            '<div class="ticket-date">'+t.updated_at+'</div></div>';
    }).join('')}catch(e){}
}
let admCurTicketId=null;
async function openAdmTicket(id){
    admCurTicketId=id;go('aticket');$('at-title').textContent='–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶';$('at-chat').innerHTML='';
    try{const r=await fetch(API+'/api/admin/tickets/'+id);if(!r.ok)return;
    const t=await r.json();$('at-title').textContent='#'+t.id+' '+t.subject;
    renderTicketChat($('at-chat'),t.messages);
    }catch(e){}
}
async function sendAdmTicketReply(){
    const text=$('at-text').value.trim();if(!text||!admCurTicketId)return;
    try{const r=await fetch(API+'/api/admin/tickets/'+admCurTicketId+'/reply',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text})});
    if(r.ok){$('at-text').value='';const t=await r.json();renderTicketChat($('at-chat'),t.messages)}else toast('–û—à–∏–±–∫–∞','error')}catch(e){toast('–û—à–∏–±–∫–∞','error')}
}

/* ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ */
function toast(m,t){const e=$('toast');e.textContent=m;e.className='toast visible'+(t?' toast-'+t:'');clearTimeout(e._t);e._t=setTimeout(()=>e.className='toast',3000)}
function showModal(h){$('modal-root').innerHTML='<div class="modal-overlay" onclick="if(event.target===this)closeModal()"><div class="modal-card">'+h+'</div></div>'}
function closeModal(){$('modal-root').innerHTML=''}
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}
function pluralDays(n){
    if(CUR_LOCALE==='EN')return n===1?'day':'days';
    if(CUR_LOCALE==='DE')return n===1?'Tag':'Tage';
    if(CUR_LOCALE==='UK'){const a=Math.abs(n)%100,b=a%10;if(a>10&&a<20)return '–¥–Ω—ñ–≤';if(b>1&&b<5)return '–¥–Ω—ñ';if(b===1)return '–¥–µ–Ω—å';return '–¥–Ω—ñ–≤'}
    const a=Math.abs(n)%100,b=a%10;if(a>10&&a<20)return '–¥–Ω–µ–π';if(b>1&&b<5)return '–¥–Ω—è';if(b===1)return '–¥–µ–Ω—å';return '–¥–Ω–µ–π'
}
</script>
{% endblock %}
